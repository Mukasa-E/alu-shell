#!/usr/bin/env bash

# Manage the manage_my_process script
PID_FILE="/var/run/my_process.pid"
SCRIPT_PATH="./manage_my_process"

start() {
    # Check if the PID file exists and if the process is already running
    if [[ -f "$PID_FILE" ]]; then
        echo "manage_my_process is already running."
        exit 1
    fi

    # Start the process and save the PID
    nohup "$SCRIPT_PATH" &> /dev/null & # Run in background, redirect output
    echo $! > "$PID_FILE" # Save the PID to the file
    echo "manage_my_process started"
}

stop() {
    if [[ ! -f "$PID_FILE" ]]; then
        echo "manage_my_process is not running."
        exit 1
    fi

    # Kill the process using the PID
    kill "$(cat "$PID_FILE")"
    rm -f "$PID_FILE" # Remove the PID file
    echo "manage_my_process stopped"
}

restart() {
    stop
    start
    echo "manage_my_process restarted"
}

# Main script logic
if [[ "$#" -eq 1 ]]; then
    case "$1" in
        start)
            start
            ;;
        stop)
            stop
            ;;
        restart)
            restart
            ;;
        *)
            echo "Usage: manage_my_process {start|stop|restart}"
            ;;
    esac
else
    echo "Usage: manage_my_process {start|stop|restart}"
fi
